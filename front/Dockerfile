FROM node:22.17

WORKDIR /home/node/app

COPY . /home/node/app

ARG GRAPHQL_CODEGEN_SCHEMA_URL
ENV GRAPHQL_CODEGEN_SCHEMA_URL=${GRAPHQL_CODEGEN_SCHEMA_URL}
ARG VITE_GRAPHQL_SERVER_URL
ENV VITE_GRAPHQL_SERVER_URL=${VITE_GRAPHQL_SERVER_URL}
ARG VITE_COGNITO_CLIENT_ID
ENV VITE_COGNITO_CLIENT_ID=${VITE_COGNITO_CLIENT_ID}
ARG VITE_COGNITO_DOMAIN
ENV VITE_COGNITO_DOMAIN=${VITE_COGNITO_DOMAIN}
ARG VITE_COGNITO_AUTHORITY
ENV VITE_COGNITO_AUTHORITY=${VITE_COGNITO_AUTHORITY}
ARG VITE_FRONT_URL
ENV VITE_FRONT_URL=${VITE_FRONT_URL}


RUN npm install
RUN npm run codegen
RUN npm run build

EXPOSE 3000

CMD ["npm", "run", "preview"]